{"version":3,"sources":["../src/actions/getCurrentWeather.ts","../src/environment.ts","../src/templates.ts","../src/examples.ts","../src/services.ts","../src/actions/index.ts","../src/index.ts"],"sourcesContent":["import { composeContext, elizaLogger } from \"@elizaos/core\";\nimport { generateMessageResponse } from \"@elizaos/core\";\nimport {\n    Action,\n    ActionExample,\n    HandlerCallback,\n    IAgentRuntime,\n    Memory,\n    ModelClass,\n    State,\n} from \"@elizaos/core\";\nimport { validateOpenWeatherConfig } from \"../environment\";\nimport { getCurrentWeatherTemplate } from \"../templates\";\nimport { getCurrentWeatherExamples } from \"../examples\";\nimport { createWeatherService } from \"../services\";\n\nexport const getCurrentWeatherAction: Action = {\n    name: \"GET_CURRENT_WEATHER\",\n    similes: [\n        \"WEATHER\",\n        \"TEMPERATURE\",\n        \"FORECAST\",\n        \"WEATHER_REPORT\",\n        \"WEATHER_UPDATE\",\n        \"CHECK_WEATHER\",\n        \"WEATHER_CHECK\",\n        \"CHECK_TEMPERATURE\",\n        \"WEATHER_OUTSIDE\",\n    ],\n    description: \"Get the current weather for a given location\",\n    validate: async (runtime: IAgentRuntime) => {\n        await validateOpenWeatherConfig(runtime);\n        return true;\n    },\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        state: State,\n        _options: { [key: string]: unknown },\n        callback: HandlerCallback\n    ) => {\n        // Initialize/update state\n        if (!state) {\n            state = (await runtime.composeState(message)) as State;\n        }\n        state = await runtime.updateRecentMessageState(state);\n\n        // state -> context\n        const weatherContext = composeContext({\n            state,\n            template: getCurrentWeatherTemplate,\n        });\n\n        // context -> content\n        const content = await generateMessageResponse({\n            runtime,\n            context: weatherContext,\n            modelClass: ModelClass.SMALL,\n        });\n\n        // parse content\n        const hasLocation =\n            content?.city && content?.country && !content?.error;\n\n        if (!hasLocation) {\n            return;\n        }\n\n        // Instantiate API service\n        const config = await validateOpenWeatherConfig(runtime);\n        const weatherService = createWeatherService(\n            config.OPEN_WEATHER_API_KEY\n        );\n\n        // Fetch weather & respond\n        try {\n            const weatherData = await weatherService.getWeather(\n                String(content?.city || \"\"),\n                content?.country ? String(content?.country) : undefined\n            );\n            elizaLogger.success(\n                `Successfully fetched weather for ${content.city}, ${content.country}`\n            );\n\n            if (callback) {\n                callback({\n                    text: `The current weather in ${content.city}, ${content.country} is ${weatherData.main.temp}°C, feels like ${weatherData.main.feels_like}°C, and is ${weatherData.weather[0].description} with a wind speed of ${weatherData.wind.speed} km/h.`,\n                    content: weatherData,\n                });\n\n                return true;\n            }\n        } catch (error) {\n            elizaLogger.error(\"Error in GET_CURRENT_WEATHER handler:\", error);\n\n            callback({\n                text: `Error fetching weather: ${error.message}`,\n                content: { error: error.message },\n            });\n\n            return false;\n        }\n\n        return;\n    },\n    examples: getCurrentWeatherExamples as ActionExample[][],\n} as Action;\n","import { IAgentRuntime } from \"@elizaos/core\";\nimport { z } from \"zod\";\n\nexport const openWeatherEnvSchema = z.object({\n    OPEN_WEATHER_API_KEY: z.string().min(1, \"OpenWeather API key is required\"),\n});\n\nexport type OpenWeatherConfig = z.infer<typeof openWeatherEnvSchema>;\n\nexport async function validateOpenWeatherConfig(\n    runtime: IAgentRuntime\n): Promise<OpenWeatherConfig> {\n    try {\n        const config = {\n            OPEN_WEATHER_API_KEY: runtime.getSetting(\"OPEN_WEATHER_API_KEY\"),\n        };\n\n        return openWeatherEnvSchema.parse(config);\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            const errorMessages = error.errors\n                .map((err) => `${err.path.join(\".\")}: ${err.message}`)\n                .join(\"\\n\");\n            throw new Error(\n                `OpenWeather configuration validation failed:\\n${errorMessages}`\n            );\n        }\n        throw error;\n    }\n}\n","export const getCurrentWeatherTemplate = `Respond with a JSON object containing location information for weather data.\nExtract the location from the most recent message. If no specific location is provided, respond with an error.\n\nThe response must include:\n- city: The city name\n- country: The country code (ISO 2-letter code)\n\nExample response:\n\\`\\`\\`json\n{\n    \"city\": \"London\",\n    \"country\": \"GB\"\n}\n\\`\\`\\`\n{{recentMessages}}\nExtract the location from the most recent message.\nRespond with a JSON markdown block containing both city and country.`;\n","import { ActionExample } from \"@elizaos/core\";\n\nexport const getCurrentWeatherExamples: ActionExample[][] = [\n    [\n        {\n            user: \"{{user1}}\",\n            content: {\n                text: \"What's the weather like right now?\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"In what city?\",\n            },\n        },\n        {\n            user: \"{{user1}}\",\n            content: {\n                text: \"Tokyo\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"Let me check the current weather in Tokyo for you.\",\n                action: \"GET_CURRENT_WEATHER\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"It's currently 22°C, feels like 29°C, and is sunny in Tokyo.\",\n            },\n        },\n    ],\n    [\n        {\n            user: \"{{user1}}\",\n            content: {\n                text: \"What's the weather in Toronto?\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"I'll check the current weather in Toronto for you.\",\n                action: \"GET_CURRENT_WEATHER\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"It's currently 22°C and cloudy in Toronto.\",\n            },\n        },\n    ],\n    [\n        {\n            user: \"{{user1}}\",\n            content: {\n                text: \"Is it raining in Paris?\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"I'll check the current weather conditions in Paris.\",\n                action: \"GET_CURRENT_WEATHER\",\n            },\n        },\n        {\n            user: \"{{agent}}\",\n            content: {\n                text: \"In Paris, it's currently cloudy with light rain. The temperature is 15°C.\",\n            },\n        },\n    ],\n];\n","import { WeatherResponse } from \"./types\";\n\nconst BASE_URL = \"https://api.openweathermap.org/data/2.5\";\n\nexport const createWeatherService = (apiKey: string) => {\n    const getWeather = async (\n        city: string,\n        country?: string\n    ): Promise<WeatherResponse> => {\n        if (!apiKey || !city) {\n            throw new Error(\"Invalid parameters\");\n        }\n\n        try {\n            const location = country ? `${city},${country}` : city;\n\n            const url = new URL(`${BASE_URL}/weather`);\n            url.searchParams.append(\"q\", location);\n            url.searchParams.append(\"appid\", apiKey);\n            url.searchParams.append(\"units\", \"metric\");\n\n            const response = await fetch(url);\n            if (!response.ok) {\n                const error = await response.json();\n                throw new Error(error?.message || response.statusText);\n            }\n\n            const data = await response.json();\n\n            return data;\n        } catch (error) {\n            console.error(\"Weather API Error:\", error.message);\n            throw error;\n        }\n    };\n\n    return { getWeather };\n};\n","export * from \"./getCurrentWeather.ts\";\n","import { Plugin } from \"@elizaos/core\";\nimport { getCurrentWeatherAction } from \"./actions/getCurrentWeather\";\n\nexport * as actions from \"./actions\";\n\nexport const openWeatherPlugin: Plugin = {\n    name: \"openweather\",\n    description: \"OpenWeather plugin for Eliza\",\n    actions: [getCurrentWeatherAction],\n    evaluators: [],\n    providers: [],\n};\nexport default openWeatherPlugin;\n"],"mappings":";;;;;;;AAAA,SAAS,gBAAgB,mBAAmB;AAC5C,SAAS,+BAA+B;AACxC;AAAA,EAMI;AAAA,OAEG;;;ACTP,SAAS,SAAS;AAEX,IAAM,uBAAuB,EAAE,OAAO;AAAA,EACzC,sBAAsB,EAAE,OAAO,EAAE,IAAI,GAAG,iCAAiC;AAC7E,CAAC;AAID,eAAsB,0BAClB,SAC0B;AAC1B,MAAI;AACA,UAAM,SAAS;AAAA,MACX,sBAAsB,QAAQ,WAAW,sBAAsB;AAAA,IACnE;AAEA,WAAO,qBAAqB,MAAM,MAAM;AAAA,EAC5C,SAAS,OAAO;AACZ,QAAI,iBAAiB,EAAE,UAAU;AAC7B,YAAM,gBAAgB,MAAM,OACvB,IAAI,CAAC,QAAQ,GAAG,IAAI,KAAK,KAAK,GAAG,CAAC,KAAK,IAAI,OAAO,EAAE,EACpD,KAAK,IAAI;AACd,YAAM,IAAI;AAAA,QACN;AAAA,EAAiD,aAAa;AAAA,MAClE;AAAA,IACJ;AACA,UAAM;AAAA,EACV;AACJ;;;AC7BO,IAAM,4BAA4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACElC,IAAM,4BAA+C;AAAA,EACxD;AAAA,IACI;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,QACN,QAAQ;AAAA,MACZ;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AAAA,EACA;AAAA,IACI;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,QACN,QAAQ;AAAA,MACZ;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AAAA,EACA;AAAA,IACI;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,QACN,QAAQ;AAAA,MACZ;AAAA,IACJ;AAAA,IACA;AAAA,MACI,MAAM;AAAA,MACN,SAAS;AAAA,QACL,MAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AACJ;;;AC5EA,IAAM,WAAW;AAEV,IAAM,uBAAuB,CAAC,WAAmB;AACpD,QAAM,aAAa,OACf,MACA,YAC2B;AAC3B,QAAI,CAAC,UAAU,CAAC,MAAM;AAClB,YAAM,IAAI,MAAM,oBAAoB;AAAA,IACxC;AAEA,QAAI;AACA,YAAM,WAAW,UAAU,GAAG,IAAI,IAAI,OAAO,KAAK;AAElD,YAAM,MAAM,IAAI,IAAI,GAAG,QAAQ,UAAU;AACzC,UAAI,aAAa,OAAO,KAAK,QAAQ;AACrC,UAAI,aAAa,OAAO,SAAS,MAAM;AACvC,UAAI,aAAa,OAAO,SAAS,QAAQ;AAEzC,YAAM,WAAW,MAAM,MAAM,GAAG;AAChC,UAAI,CAAC,SAAS,IAAI;AACd,cAAM,QAAQ,MAAM,SAAS,KAAK;AAClC,cAAM,IAAI,MAAM,OAAO,WAAW,SAAS,UAAU;AAAA,MACzD;AAEA,YAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,aAAO;AAAA,IACX,SAAS,OAAO;AACZ,cAAQ,MAAM,sBAAsB,MAAM,OAAO;AACjD,YAAM;AAAA,IACV;AAAA,EACJ;AAEA,SAAO,EAAE,WAAW;AACxB;;;AJrBO,IAAM,0BAAkC;AAAA,EAC3C,MAAM;AAAA,EACN,SAAS;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AAAA,EACA,aAAa;AAAA,EACb,UAAU,OAAO,YAA2B;AACxC,UAAM,0BAA0B,OAAO;AACvC,WAAO;AAAA,EACX;AAAA,EACA,SAAS,OACL,SACA,SACA,OACA,UACA,aACC;AAED,QAAI,CAAC,OAAO;AACR,cAAS,MAAM,QAAQ,aAAa,OAAO;AAAA,IAC/C;AACA,YAAQ,MAAM,QAAQ,yBAAyB,KAAK;AAGpD,UAAM,iBAAiB,eAAe;AAAA,MAClC;AAAA,MACA,UAAU;AAAA,IACd,CAAC;AAGD,UAAM,UAAU,MAAM,wBAAwB;AAAA,MAC1C;AAAA,MACA,SAAS;AAAA,MACT,YAAY,WAAW;AAAA,IAC3B,CAAC;AAGD,UAAM,cACF,SAAS,QAAQ,SAAS,WAAW,CAAC,SAAS;AAEnD,QAAI,CAAC,aAAa;AACd;AAAA,IACJ;AAGA,UAAM,SAAS,MAAM,0BAA0B,OAAO;AACtD,UAAM,iBAAiB;AAAA,MACnB,OAAO;AAAA,IACX;AAGA,QAAI;AACA,YAAM,cAAc,MAAM,eAAe;AAAA,QACrC,OAAO,SAAS,QAAQ,EAAE;AAAA,QAC1B,SAAS,UAAU,OAAO,SAAS,OAAO,IAAI;AAAA,MAClD;AACA,kBAAY;AAAA,QACR,oCAAoC,QAAQ,IAAI,KAAK,QAAQ,OAAO;AAAA,MACxE;AAEA,UAAI,UAAU;AACV,iBAAS;AAAA,UACL,MAAM,0BAA0B,QAAQ,IAAI,KAAK,QAAQ,OAAO,OAAO,YAAY,KAAK,IAAI,qBAAkB,YAAY,KAAK,UAAU,iBAAc,YAAY,QAAQ,CAAC,EAAE,WAAW,yBAAyB,YAAY,KAAK,KAAK;AAAA,UACxO,SAAS;AAAA,QACb,CAAC;AAED,eAAO;AAAA,MACX;AAAA,IACJ,SAAS,OAAO;AACZ,kBAAY,MAAM,yCAAyC,KAAK;AAEhE,eAAS;AAAA,QACL,MAAM,2BAA2B,MAAM,OAAO;AAAA,QAC9C,SAAS,EAAE,OAAO,MAAM,QAAQ;AAAA,MACpC,CAAC;AAED,aAAO;AAAA,IACX;AAEA;AAAA,EACJ;AAAA,EACA,UAAU;AACd;;;AK1GA;AAAA;AAAA;AAAA;;;ACKO,IAAM,oBAA4B;AAAA,EACrC,MAAM;AAAA,EACN,aAAa;AAAA,EACb,SAAS,CAAC,uBAAuB;AAAA,EACjC,YAAY,CAAC;AAAA,EACb,WAAW,CAAC;AAChB;AACA,IAAO,gBAAQ;","names":[]}